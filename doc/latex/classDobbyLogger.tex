\hypertarget{classDobbyLogger}{}\doxysection{Dobby\+Logger Class Reference}
\label{classDobbyLogger}\index{DobbyLogger@{DobbyLogger}}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classDobbyLogger_a4d8428d3bb81e429af4580957f683707}\label{classDobbyLogger_a4d8428d3bb81e429af4580957f683707}} 
{\bfseries Dobby\+Logger} (const std\+::shared\+\_\+ptr$<$ const \mbox{\hyperlink{classIDobbySettings}{IDobby\+Settings}} $>$ \&settings)
\item 
bool \mbox{\hyperlink{classDobbyLogger_a813e8b6b7033adaf237c51e5cf20e3bc}{Start\+Container\+Logging}} (std\+::string container\+Id, pid\+\_\+t runtime\+Pid, pid\+\_\+t container\+Pid, std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classIDobbyRdkLoggingPlugin}{IDobby\+Rdk\+Logging\+Plugin}} $>$ logging\+Plugin)
\begin{DoxyCompactList}\small\item\em Public method that should be called once a container has been created to match the container PID with the runtime PID to start running the logging thread based on whichever logging plugin is loaded. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classDobbyLogger_a1fd736649690561cc2927b4ed44087f4}{Dump\+Buffer}} (int buffer\+Mem\+Fd, pid\+\_\+t container\+Pid, std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classIDobbyRdkLoggingPlugin}{IDobby\+Rdk\+Logging\+Plugin}} $>$ logging\+Plugin)
\begin{DoxyCompactList}\small\item\em Blocking method that writes the contents of a buffer at a given mem\+Fd to the logger specified in the container config. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classDobbyLogger_a2fce02a80c06c08f61353e5db564469e}\label{classDobbyLogger_a2fce02a80c06c08f61353e5db564469e}} 
int {\bfseries create\+Dgram\+Socket} (const std\+::string \&path)
\item 
int \mbox{\hyperlink{classDobbyLogger_a528503886e206ae68b25b2f981f239e7}{create\+Unix\+Socket}} (const std\+::string path)
\begin{DoxyCompactList}\small\item\em Create a new UNIX domain socket that the OCI runtime can connect to and send the fd of the ptty used for the container. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{classDobbyLogger_a8b3fdaf8267936cd85bde4eb05b350b9}{receive\+Fd\+From\+Socket}} (const int connection\+Fd)
\begin{DoxyCompactList}\small\item\em Once a connection to the socket has been made, wait to receive a message that contains a file descriptor. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classDobbyLogger_aff0122d914e9bd05a10961ff5109b18c}{connection\+Monitor\+Thread}} (const int socket\+Fd)
\begin{DoxyCompactList}\small\item\em Runs for the lifetime of the daemon, waiting for new connections to the socket. Once a connection is received, add to the map. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classDobbyLogger_ade5b251a7224b1d94653d1f0fd034d3d}\label{classDobbyLogger_ade5b251a7224b1d94653d1f0fd034d3d}} 
void \mbox{\hyperlink{classDobbyLogger_ade5b251a7224b1d94653d1f0fd034d3d}{close\+And\+Delete\+Socket}} (const int fd, const std\+::string \&path)
\begin{DoxyCompactList}\small\item\em Closes and deletes a socket at a given fd/path. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classDobbyLogger_a28fbd637a3f4228c48bc89ccb723eb49}\label{classDobbyLogger_a28fbd637a3f4228c48bc89ccb723eb49}} 
std\+::mutex {\bfseries m\+Lock}
\item 
\mbox{\Hypertarget{classDobbyLogger_adde2443c1d77e56b6e85bd3595649088}\label{classDobbyLogger_adde2443c1d77e56b6e85bd3595649088}} 
int {\bfseries m\+Socket\+Fd}
\item 
\mbox{\Hypertarget{classDobbyLogger_acdecd9c3b5c5a758b0ce8bfb0a7abe64}\label{classDobbyLogger_acdecd9c3b5c5a758b0ce8bfb0a7abe64}} 
const std\+::string {\bfseries m\+Socket\+Path}
\item 
\mbox{\Hypertarget{classDobbyLogger_a59bab86e8fabf1bb495f26a93986090d}\label{classDobbyLogger_a59bab86e8fabf1bb495f26a93986090d}} 
const std\+::string {\bfseries m\+Syslog\+Socket\+Path}
\item 
\mbox{\Hypertarget{classDobbyLogger_a5f6dc32b1750537715227027e1417e71}\label{classDobbyLogger_a5f6dc32b1750537715227027e1417e71}} 
const std\+::string {\bfseries m\+Journald\+Socket\+Path}
\item 
\mbox{\Hypertarget{classDobbyLogger_a653585412f26bcbc67f7914861fc76f6}\label{classDobbyLogger_a653585412f26bcbc67f7914861fc76f6}} 
std\+::map$<$ pid\+\_\+t, int $>$ {\bfseries m\+Temp\+Fds}
\item 
\mbox{\Hypertarget{classDobbyLogger_aca471868fb3e66c6f14fcc7aac84e549}\label{classDobbyLogger_aca471868fb3e66c6f14fcc7aac84e549}} 
std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classAICommon_1_1PollLoop}{AICommon\+::\+Poll\+Loop}} $>$ {\bfseries m\+Poll\+Loop}
\item 
\mbox{\Hypertarget{classDobbyLogger_aa30c12fd9d724941210536fc402f5f9a}\label{classDobbyLogger_aa30c12fd9d724941210536fc402f5f9a}} 
std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classDobbyLogRelay}{Dobby\+Log\+Relay}} $>$ {\bfseries m\+Syslog\+Relay}
\item 
\mbox{\Hypertarget{classDobbyLogger_a8ce091dda07cd5c687eae2087c97f7d8}\label{classDobbyLogger_a8ce091dda07cd5c687eae2087c97f7d8}} 
std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classDobbyLogRelay}{Dobby\+Log\+Relay}} $>$ {\bfseries m\+Journald\+Relay}
\end{DoxyCompactItemize}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classDobbyLogger_aff0122d914e9bd05a10961ff5109b18c}\label{classDobbyLogger_aff0122d914e9bd05a10961ff5109b18c}} 
\index{DobbyLogger@{DobbyLogger}!connectionMonitorThread@{connectionMonitorThread}}
\index{connectionMonitorThread@{connectionMonitorThread}!DobbyLogger@{DobbyLogger}}
\doxysubsubsection{\texorpdfstring{connectionMonitorThread()}{connectionMonitorThread()}}
{\footnotesize\ttfamily void Dobby\+Logger\+::connection\+Monitor\+Thread (\begin{DoxyParamCaption}\item[{const int}]{socket\+Fd }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Runs for the lifetime of the daemon, waiting for new connections to the socket. Once a connection is received, add to the map. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em socket\+Fd} & FD of the socket passed to the runtime --console-\/socket param \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{classDobbyLogger_a528503886e206ae68b25b2f981f239e7}\label{classDobbyLogger_a528503886e206ae68b25b2f981f239e7}} 
\index{DobbyLogger@{DobbyLogger}!createUnixSocket@{createUnixSocket}}
\index{createUnixSocket@{createUnixSocket}!DobbyLogger@{DobbyLogger}}
\doxysubsubsection{\texorpdfstring{createUnixSocket()}{createUnixSocket()}}
{\footnotesize\ttfamily int Dobby\+Logger\+::create\+Unix\+Socket (\begin{DoxyParamCaption}\item[{const std\+::string}]{path }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Create a new UNIX domain socket that the OCI runtime can connect to and send the fd of the ptty used for the container. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em path} & Where to create the socket \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{classDobbyLogger_a1fd736649690561cc2927b4ed44087f4}\label{classDobbyLogger_a1fd736649690561cc2927b4ed44087f4}} 
\index{DobbyLogger@{DobbyLogger}!DumpBuffer@{DumpBuffer}}
\index{DumpBuffer@{DumpBuffer}!DobbyLogger@{DobbyLogger}}
\doxysubsubsection{\texorpdfstring{DumpBuffer()}{DumpBuffer()}}
{\footnotesize\ttfamily bool Dobby\+Logger\+::\+Dump\+Buffer (\begin{DoxyParamCaption}\item[{int}]{buffer\+Mem\+Fd,  }\item[{pid\+\_\+t}]{container\+Pid,  }\item[{std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classIDobbyRdkLoggingPlugin}{IDobby\+Rdk\+Logging\+Plugin}} $>$}]{logging\+Plugin }\end{DoxyParamCaption})}



Blocking method that writes the contents of a buffer at a given mem\+Fd to the logger specified in the container config. 

Mainly used for writing the contents of the OCI hooks stdout/err to the container logfile


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em buffer\+Mem\+Fd} & fd of the buffer \\
\hline
\mbox{\texttt{ in}}  & {\em container\+Pid} & PID of the container the logs belong to \\
\hline
\mbox{\texttt{ in}}  & {\em logging\+Pluing} & The logging plugin the contents of the buffer should be sent to \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{classDobbyLogger_a8b3fdaf8267936cd85bde4eb05b350b9}\label{classDobbyLogger_a8b3fdaf8267936cd85bde4eb05b350b9}} 
\index{DobbyLogger@{DobbyLogger}!receiveFdFromSocket@{receiveFdFromSocket}}
\index{receiveFdFromSocket@{receiveFdFromSocket}!DobbyLogger@{DobbyLogger}}
\doxysubsubsection{\texorpdfstring{receiveFdFromSocket()}{receiveFdFromSocket()}}
{\footnotesize\ttfamily int Dobby\+Logger\+::receive\+Fd\+From\+Socket (\begin{DoxyParamCaption}\item[{const int}]{connection\+Fd }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Once a connection to the socket has been made, wait to receive a message that contains a file descriptor. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em connection\+Fd} & fd of the connection to the \mbox{\hyperlink{classDobby}{Dobby}} logging socket \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{classDobbyLogger_a813e8b6b7033adaf237c51e5cf20e3bc}\label{classDobbyLogger_a813e8b6b7033adaf237c51e5cf20e3bc}} 
\index{DobbyLogger@{DobbyLogger}!StartContainerLogging@{StartContainerLogging}}
\index{StartContainerLogging@{StartContainerLogging}!DobbyLogger@{DobbyLogger}}
\doxysubsubsection{\texorpdfstring{StartContainerLogging()}{StartContainerLogging()}}
{\footnotesize\ttfamily bool Dobby\+Logger\+::\+Start\+Container\+Logging (\begin{DoxyParamCaption}\item[{std\+::string}]{container\+Id,  }\item[{pid\+\_\+t}]{runtime\+Pid,  }\item[{pid\+\_\+t}]{container\+Pid,  }\item[{std\+::shared\+\_\+ptr$<$ \mbox{\hyperlink{classIDobbyRdkLoggingPlugin}{IDobby\+Rdk\+Logging\+Plugin}} $>$}]{logging\+Plugin }\end{DoxyParamCaption})}



Public method that should be called once a container has been created to match the container PID with the runtime PID to start running the logging thread based on whichever logging plugin is loaded. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em container\+Id} & Name of the container \\
\hline
\mbox{\texttt{ in}}  & {\em runtime\+Pid} & PID of the OCI runtime that connected to the socket \\
\hline
\mbox{\texttt{ in}}  & {\em container\+Pid} & PID of the running container \\
\hline
\mbox{\texttt{ in}}  & {\em logging\+Plugin} & Plugin that will process the container logs\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if thread started successfully 
\end{DoxyReturn}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
daemon/lib/source/Dobby\+Logger.\+h\item 
daemon/lib/source/Dobby\+Logger.\+cpp\end{DoxyCompactItemize}
